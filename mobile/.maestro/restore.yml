# Testplan:
# - restore the wallet
# - check all the networks have no null balance

appId: com.layerzwallet.mobile
jsEngine: graaljs
---
- runFlow:
    file: subflows/wallet-restore.yml
    env:
      MNEMONIC: ${MAESTRO_TEST_MNEMONIC}

# run for some networks (where we have non-zero balance)
- evalScript: ${output.networks = ['bitcoin', 'spark']} # 'rootstock'
- repeat:
    while:
      true: ${output.networks.length > 0}
    commands:
      # switch to the next network
      - runFlow:
          file: subflows/network-switch.yml
          env:
            NETWORK: ${output.networks.shift()}
      # wait for the balance to load
      - assertVisible:
          id: 'LayerBalance'
      - extendedWaitUntil:
          notVisible: '???'
          timeout: 60000

      - copyTextFrom:
          id: 'LayerActualBalance'
      - evalScript: ${output.balance = maestro.copiedText}
      - evalScript: ${console.log(output.balance);}
      - evalScript: ${console.log(parseFloat(output.balance));}
      # guard against NaN:
      - evalScript: ${if (parseFloat(output.balance) > 0) {} else throw new Error("bad balance = " + output.balance)  }
